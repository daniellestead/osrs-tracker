use serde::{Serialize, Deserialize};
use std::sync::mpsc::Receiver;

#[derive(Default, Serialize, Deserialize, Debug)]
pub struct Player {
    pub name: String,
    pub skills: Vec<Skill>,
    pub editing: bool,
    pub syncing: bool,
    pub sync_error: Option<String>,
    #[serde(skip)]
    pub sync_rx: Option<Receiver<Result<Vec<Skill>, String>>>,
}

#[derive(Serialize, Deserialize, Clone, Default, Debug)]
pub struct Skill {
    pub name: String,
    pub level: u32,
    pub xp: u64,
}

#[derive(Debug)]
pub struct LevelXP {
    level: u8,
    xp: u32,
}

pub fn get_xp_for_level(level: u8) -> Option<u32> {
    XP_TABLE.iter().find(|entry| entry.level == level).map(|entry| entry.xp)
}

static XP_TABLE: [LevelXP; 99] = [
    LevelXP { level: 1, xp: 0 },
    LevelXP { level: 2, xp: 83 },
    LevelXP { level: 3, xp: 174 },
    LevelXP { level: 4, xp: 276 },
    LevelXP { level: 5, xp: 388 },
    LevelXP { level: 6, xp: 512 },
    LevelXP { level: 7, xp: 650 },
    LevelXP { level: 8, xp: 801 },
    LevelXP { level: 9, xp: 969 },
    LevelXP { level: 10, xp: 1154 },
    LevelXP { level: 11, xp: 1358 },
    LevelXP { level: 12, xp: 1584 },
    LevelXP { level: 13, xp: 1833 },
    LevelXP { level: 14, xp: 2107 },
    LevelXP { level: 15, xp: 2411 },
    LevelXP { level: 16, xp: 2746 },
    LevelXP { level: 17, xp: 3115 },
    LevelXP { level: 18, xp: 3523 },
    LevelXP { level: 19, xp: 3973 },
    LevelXP { level: 20, xp: 4470 },
    LevelXP { level: 21, xp: 5018 },
    LevelXP { level: 22, xp: 5624 },
    LevelXP { level: 23, xp: 6291 },
    LevelXP { level: 24, xp: 7028 },
    LevelXP { level: 25, xp: 7842 },
    LevelXP { level: 26, xp: 8740 },
    LevelXP { level: 27, xp: 9730 },
    LevelXP { level: 28, xp: 10824 },
    LevelXP { level: 29, xp: 12031 },
    LevelXP { level: 30, xp: 13363 },
    LevelXP { level: 31, xp: 14833 },
    LevelXP { level: 32, xp: 16456 },
    LevelXP { level: 33, xp: 18247 },
    LevelXP { level: 34, xp: 20224 },
    LevelXP { level: 35, xp: 22406 },
    LevelXP { level: 36, xp: 24815 },
    LevelXP { level: 37, xp: 27473 },
    LevelXP { level: 38, xp: 30408 },
    LevelXP { level: 39, xp: 33648 },
    LevelXP { level: 40, xp: 37224 },
    LevelXP { level: 41, xp: 41171 },
    LevelXP { level: 42, xp: 45529 },
    LevelXP { level: 43, xp: 50339 },
    LevelXP { level: 44, xp: 55649 },
    LevelXP { level: 45, xp: 61512 },
    LevelXP { level: 46, xp: 67983 },
    LevelXP { level: 47, xp: 75127 },
    LevelXP { level: 48, xp: 83014 },
    LevelXP { level: 49, xp: 91721 },
    LevelXP { level: 50, xp: 101333 },
    LevelXP { level: 51, xp: 111945 },
    LevelXP { level: 52, xp: 123660 },
    LevelXP { level: 53, xp: 136594 },
    LevelXP { level: 54, xp: 150872 },
    LevelXP { level: 55, xp: 166636 },
    LevelXP { level: 56, xp: 184040 },
    LevelXP { level: 57, xp: 203254 },
    LevelXP { level: 58, xp: 224466 },
    LevelXP { level: 59, xp: 247886 },
    LevelXP { level: 60, xp: 273742 },
    LevelXP { level: 61, xp: 302288 },
    LevelXP { level: 62, xp: 333804 },
    LevelXP { level: 63, xp: 368599 },
    LevelXP { level: 64, xp: 407015 },
    LevelXP { level: 65, xp: 449428 },
    LevelXP { level: 66, xp: 496254 },
    LevelXP { level: 67, xp: 547953 },
    LevelXP { level: 68, xp: 605032 },
    LevelXP { level: 69, xp: 668051 },
    LevelXP { level: 70, xp: 737627 },
    LevelXP { level: 71, xp: 814445 },
    LevelXP { level: 72, xp: 899257 },
    LevelXP { level: 73, xp: 992895 },
    LevelXP { level: 74, xp: 1096278 },
    LevelXP { level: 75, xp: 1210421 },
    LevelXP { level: 76, xp: 1336443 },
    LevelXP { level: 77, xp: 1475581 },
    LevelXP { level: 78, xp: 1629200 },
    LevelXP { level: 79, xp: 1798808 },
    LevelXP { level: 80, xp: 1986068 },
    LevelXP { level: 81, xp: 2192818 },
    LevelXP { level: 82, xp: 2421087 },
    LevelXP { level: 83, xp: 2673114 },
    LevelXP { level: 84, xp: 2951373 },
    LevelXP { level: 85, xp: 3258594 },
    LevelXP { level: 86, xp: 3597792 },
    LevelXP { level: 87, xp: 3972294 },
    LevelXP { level: 88, xp: 4385776 },
    LevelXP { level: 89, xp: 4842295 },
    LevelXP { level: 90, xp: 5346332 },
    LevelXP { level: 91, xp: 5902831 },
    LevelXP { level: 92, xp: 6517253 },
    LevelXP { level: 93, xp: 7195629 },
    LevelXP { level: 94, xp: 7944614 },
    LevelXP { level: 95, xp: 8771558 },
    LevelXP { level: 96, xp: 9684577 },
    LevelXP { level: 97, xp: 10692629 },
    LevelXP { level: 98, xp: 11805606 },
    LevelXP { level: 99, xp: 13034431 },
];
